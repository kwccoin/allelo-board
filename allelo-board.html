<template id="allelo-board">
    <style>
        :host {
            display: inline-block;  /* or display: block; */
        }
        .container {
            position: relative;
        }
        canvas {
            display: block; /* デフォルトのinlineのままだとcanvasの下に隙間が入る */
        }
        #goban {
            position: relative;
            background-image: url(data:image/png;base64,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);
            background-color: rgb(196, 127, 51);
        }
        #leaves, #stones {
            position: absolute;
            top: 0px;
        }
    </style>
    <div class="container">
        <canvas id="goban" width="768" height="768"></canvas>
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="leaves" width="768" height="768">
            <defs>
                <path
                id="leaf"
                d="m 0,-145 c -5.36199,-1.5478604 -14.21002,-8.6465004 -15.2827,-22.05113 -1.07198,-13.40533 13.94132,-32.17336 16.35468,-37.80264 2.41335,-5.63069 5.89798,0.53528 10.72469,5.36199 4.826,4.82601 31.099959,32.70794 -3.21876,54.1573096 -2.1991,1.3477504 -2.12414,2.5074104 -1.84201,5.7565604 0.4773,5.48079 1.34068,4.67681 0.86479,5.39169 -0.94116,1.41068 -4.76802,1.98344 -4.7666,0.4773 -0.001,-8.58004 -3.771,-25.1482604 -0.50983,-37.92426 4.29002,-16.80157 1.5521,-19.18452 1.5521,-19.18452 0,0 -1.6617,10.93895 -3.51856,18.29286 -4.46821,17.69534958 -0.3578,27.52484 -0.3578,27.52484 z"/>
            </defs>
            <defs>
                <g id="four-leaves">
                    <use
                    xlink:href="#leaf"
                    transform="rotate(0)" 
                    />
                    <use
                    xlink:href="#leaf"
                    transform="rotate(90)" 
                    />
                    <use
                    xlink:href="#leaf"
                    transform="rotate(180)" 
                    />
                    <use
                    xlink:href="#leaf"
                    transform="rotate(270)" 
                    />
                </g>
            </defs>
        </svg>
        <canvas id="stones" width="768" height="768"></canvas>
    </div>
    <script id="vs" type="x-shader/x-vertex">
        attribute vec2 position;

        void main() {
            // position specifies only x and y.
            // We set z to be 0.0, and w to be 1.0
            gl_Position = vec4(position, 0.0, 1.0);
        }
    </script>
    <script id="fs" type="x-shader/x-fragment">
        precision lowp float;
        const int BOARD_WIDTH = %BOARD_WIDTH%;
        const int BOARD_HEIGHT = %BOARD_HEIGHT%;
        const float WIDTH = %WIDTH%.0;
        const float HEIGHT = %HEIGHT%.0;
        uniform float states[BOARD_WIDTH * BOARD_HEIGHT];
        
        void main() {
            float _width = WIDTH / float(BOARD_WIDTH) / 2.0;
            float _height = HEIGHT / float(BOARD_HEIGHT) / 2.0;
            float x = gl_FragCoord.x;
            float y = gl_FragCoord.y;
            float b = 0.0;
            float w = 0.0;
            for (int j = 0; j < BOARD_HEIGHT; j++) {
                for (int i = 0; i < BOARD_WIDTH; i++) {
                    float r = states[i + j * BOARD_WIDTH];
                    float dx = _width + float(i) * 2.0 * _width - x;
                    float dy = _height + float(j) * 2.0 * _height - (HEIGHT - y);
                    float ratio = r*r/(dx*dx + dy*dy);
                    ratio = ratio * ratio;
                    ratio = ratio * ratio;
                    ratio = ratio * ratio;
                    if (r > 0.0) {
                        b += ratio;
                    } else {
                        w += ratio;
                    }
                }
            }
            float alpha = float(b > 1.0 || w > 1.0);
            float white = float(w > 1.0);
            gl_FragColor = vec4(0.0, white + 0.3, 0.0, alpha);
        }
    </script>
</template>
