<template id="puyo-go-board">
    <style>
        div {
            position: relative;
        }
        canvas {
            position: absolute;
        }
        #goban {
            background-image: url(wood2.jpg);
        }
    </style>
    <div>
        <canvas id="goban" width="768" height="768"></canvas>
        <canvas id="stones" width="768" height="768"></canvas>
    </div>
    <script id="vs" type="x-shader/x-vertex">
        attribute vec2 position;

        void main() {
            // position specifies only x and y.
            // We set z to be 0.0, and w to be 1.0
            gl_Position = vec4(position, 0.0, 1.0);
        }
    </script>
    <script id="fs" type="x-shader/x-fragment">
        precision highp float;
        const int BOARD_WIDTH = %BOARD_WIDTH%;
        const int BOARD_HEIGHT = %BOARD_HEIGHT%;
        const float WIDTH = %WIDTH%.0;
        const float HEIGHT = %HEIGHT%.0;
        uniform float states[BOARD_WIDTH * BOARD_HEIGHT];
        
        void main() {
            float _width = WIDTH / float(BOARD_WIDTH) / 2.0;
            float _height = HEIGHT / float(BOARD_HEIGHT) / 2.0;
            float x = gl_FragCoord.x;
            float y = gl_FragCoord.y;
            float b = 0.0;
            float w = 0.0;
            for (int j = 0; j < BOARD_HEIGHT; j++) {
                for (int i = 0; i < BOARD_WIDTH; i++) {
                    float r = states[i + j * BOARD_WIDTH];
                    float dx = _width + float(i) * 2.0 * _width - x;
                    float dy = _height + float(j) * 2.0 * _height - (HEIGHT - y);
                    float ratio = r*r/(dx*dx + dy*dy);
                    if (r > 0.0) {
                        b += ratio * ratio * ratio;
                    } else {
                        w += ratio * ratio * ratio;
                    }
                }
            }
            float alpha = float(b > 1.0 || w > 1.0);
            float white = float(w > 1.0);
            gl_FragColor = vec4(white, white, white, alpha);
        }
    </script>
</template>
